<!DOCTYPE html>
<html lang="en">
<head>
    <link href="https://fonts.googleapis.com/css?family=Montserrat:300,400,700|Roboto:400,700" rel="stylesheet">
    <link href='style.css' rel='stylesheet' type='text/css'>
    <title>InfValues Results</title>
    <link rel="icon" type="x-icon" href="icon.png">
    <link rel="shortcut icon" type="x-icon" href="icon.png">
     <meta content="text/html; charset=windows-1251" http-equiv="Content-Type">
	 <meta content="text/html; charset=utf-8" http-equiv="Content-Type">

    <script src="js\marvinjs-1.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/color-thief/2.3.0/color-thief.umd.js"></script>
    <script type="application/javascript" src="js\axes.js"></script>

</head>
<body>
    <h1>InfValues</h1>
    <hr>

    <h1>Results</h1>
    <br>

    <div class="center-container">
        <p style="margin:-2px auto">
            Thanks for taking the test! Here are your results below.
            There are currently 45 Axes in the test. <b>This test is not completed yet.</b>
        </p>
        <br>


        <p id="compareCta" style="margin: 0">
            If you have someone else's link, you can
            <a href="#" class="toggle-compare-button">click here to compare</a>
            your results.
        </p>

        <div id="compareContainer" style="display: none">
            <p style="margin: 0;">
                Paste a link below to compare the results. An arrow
                will indicate how different are the results from the link.
                <a href="#" class="toggle-compare-button">Disable comparison</a>
            </p>
            <input id="compareLinkInput" type="text"
                   style="width: 100%; font-size: 0.9em; padding: 4px; margin: 16px 0 0;"
                   placeholder="Paste a link to compare" />
        </div>
        <br>
    </div>

    <div id="results">
        <!--<div class="axis">
            <img id="img-equality" src="equality.svg" height="128pt" />
            <div class="bar equality" id="bar-equality"><div class="text-wrapper" id="equality"></div></div>
            <div class="bar wealth" id="bar-wealth"><div class="text-wrapper" id="wealth"></div></div>
            <img id="img-wealth" src="markets.svg" height="128pt" />
        </div>-->
    </div>


    <div class="center-container">
        <p style="margin:0">
            If you have any suggestions or opinions about this test, please fill in <a href="https://forms.gle/AA5aYwSb9MnHunMc8">this form</a>.
        </p>
        </br>
    </div>

    <canvas id="canvas"></canvas>
    <button class="button" onclick="location.href='index.html';" style="background-color: #2196f3;">Back</button>
    <br>

    <img id="compass" src="compass.png" alt="Image" style="display: none;" />

    <script>
        function GetBarColor(ideologyName) {

        }
        function GetQueryVariable(variable) {
            var query = window.location.search.substring(1)
            var vars = query.split("&")
            for (var i = 0; i < vars.length; i++) {
                var pair = vars[i].split("=")
                if (pair[0] == variable) { return pair[1] }
            }
            return (NaN);
        }

        function SetBarValue(name, value) {
            innerel = document.getElementById(name)
            outerel = document.getElementById("bar-" + name)
            outerel.style.width = (value + "%")
            innerel.innerHTML = (value + "%")
            if (innerel.offsetWidth + 20 > outerel.offsetWidth) {
                innerel.style.visibility = "hidden"
            }
        }

        function GenerateImage(name, height) {
            let image = document.createElement("img");
            image.setAttribute("id", "img-" + name);
            image.setAttribute("src", "ideologyIcons\\" + name + ".png"); //change to .svg later
            image.setAttribute("height", height);

            return image;
        }
        function GenerateBar(name) {
            let bar = document.createElement("div");
            bar.setAttribute("class", "bar " + name);
            bar.setAttribute("id", "bar-" + name);

            //const colorThief = new ColorThief();
            //const img = new Image();

            /* img.addEventListener('load', function () {*/
            //    const rgbToHex = (r, g, b) => '#' + [r, g, b].map(x => {
            //        const hex = x.toString(16)
            //        return hex.length === 1 ? '0' + hex : hex
            //    }).join('')
            //    var color = colorThief.getColor(img);
            //    var hexColor = rgbToHex(color[0], color[1], color[2]);
            //    console.log(color);
            //    bar.style.backgroundColor = hexColor;
            //    bar.style.borderStyle = 'solid';
            //});
            //let imageURL = 'ideologyIcons\\cropped\\' + name + '.png';
            //img.crossOrigin = 'Anonymous';
            //img.src = (imageURL);

            let textWrapper = document.createElement("div");
            textWrapper.setAttribute("class", "text-wrapper");
            textWrapper.setAttribute("id", name);

            bar.appendChild(textWrapper);

            return bar;
        }
        function GetAxis(shortenedName, leftName, rightName) {
            let mainDiv = document.createElement("div");
            mainDiv.className = "axis";

            let header = document.createElement("h2");
            console.log(shortenedName);
            header.innerHTML = "Най-близко попадение: " + axes[0]["labels"][0];

            let leftImage = GenerateImage(leftName, 128);
            let rightImage = GenerateImage(rightName, 128);

            let leftBar = GenerateBar(leftName);
            let rightBar = GenerateBar(rightName);
            leftBar.style.textAlign = "left";
            rightBar.style.textAlign = "right";

            mainDiv.appendChild(header);
            mainDiv.appendChild(leftImage);
            mainDiv.appendChild(leftBar);
            mainDiv.appendChild(rightBar);
            mainDiv.appendChild(rightImage);

            return mainDiv;
        }
        //console.log(GetBarColor("socialist"));
        var results = document.getElementById("results");
        for (var i = 0; i < axes.length; i++) {
            var axis = axes[i];
            var leftValue = GetQueryVariable(axis["shortenedName"]);

            results.appendChild(GetAxis(axis["shortenedName"], axis["leftSide"], axis["rightSide"]));
            SetBarValue(axis["leftSide"], leftValue);
            SetBarValue(axis["rightSide"], (100 - leftValue).toFixed(1));
        }


    </script>
</body>
</html>
